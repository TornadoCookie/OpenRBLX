#include "specialmesh.h"
#include <rlgl.h>

#include "debug.h"
DEFAULT_DEBUG_CHANNEL(specialmesh)

// cazually stolen from OpenBLOX
static void draw_head()
{
    rlBegin(RL_TRIANGLES);
		rlVertex3f(-0.932322,0.596227,0.399221);
		rlVertex3f(-0.640764,-0.680105,0.763315);
		rlVertex3f(-0.480241,0.605489,0.898445);
		rlVertex3f(-0.098312,0.604673,-0.999773);
		rlVertex3f(0.150962,-0.650408,-0.990247);
		rlVertex3f(-0.22392,-0.648345,-0.979736);
		rlVertex3f(0.996989,0.596266,0.186017);
		rlVertex3f(0.980003,-0.64308,-0.214305);
		rlVertex3f(0.891344,0.604282,-0.50115);
		rlVertex3f(-0.46681,1.001006,0.438334);
		rlVertex3f(0.692168,0.993242,-0.039351);
		rlVertex3f(0.281587,0.989665,-0.627556);
		rlVertex3f(0.186015,0.596253,0.996994);
		rlVertex3f(0.58222,-0.653549,0.816662);
		rlVertex3f(0.714215,0.614959,0.71421);
		rlVertex3f(0.891344,0.604282,-0.50115);
		rlVertex3f(0.853584,-0.654746,-0.521982);
		rlVertex3f(0.547863,-0.663036,-0.837863);
		rlVertex3f(-0.480241,0.605489,0.898445);
		rlVertex3f(-0.640764,-0.680105,0.763315);
		rlVertex3f(-0.18976,-0.646655,0.988061);
		rlVertex3f(-0.098312,0.604673,-0.999773);
		rlVertex3f(0.268884,0.808944,-0.88636);
		rlVertex3f(0.386682,0.598722,-0.933498);
		rlVertex3f(-0.298104,0.811837,-0.891479);
		rlVertex3f(-0.098312,0.604673,-0.999773);
		rlVertex3f(-0.473573,0.595546,-0.886123);
		rlVertex3f(0.631663,0.955669,0.440243);
		rlVertex3f(0.816878,0.808942,0.43663);
		rlVertex3f(0.927452,0.813011,-0.00863);
		rlVertex3f(0.186015,0.596253,0.996994);
		rlVertex3f(-0.271929,0.811363,0.896421);
		rlVertex3f(-0.480241,0.605489,0.898445);
		rlVertex3f(-0.761151,0.809834,0.536443);
		rlVertex3f(-0.300621,0.952344,0.694293);
		rlVertex3f(-0.667179,0.954409,0.361812);
		rlVertex3f(0.547863,-0.663036,-0.837863);
		rlVertex3f(0.318952,-0.885314,-0.78363);
		rlVertex3f(0.150962,-0.650408,-0.990247);
		rlVertex3f(0.927452,0.813011,-0.00863);
		rlVertex3f(0.996989,0.596266,0.186017);
		rlVertex3f(0.891344,0.604282,-0.50115);
		rlVertex3f(-0.18976,-0.646655,0.988061);
		rlVertex3f(-0.400676,-0.891997,0.74961);
		rlVertex3f(0.245288,-0.89031,0.808608);
		rlVertex3f(0.816878,0.808942,0.43663);
		rlVertex3f(0.714215,0.614959,0.71421);
		rlVertex3f(0.996989,0.596266,0.186017);
		rlVertex3f(0.98674,-0.651095,0.163856);
		rlVertex3f(0.749797,-0.887712,0.407642);
		rlVertex3f(0.776975,-0.906855,-0.321834);
		rlVertex3f(0.927452,0.813011,-0.00863);
		rlVertex3f(0.692168,0.993242,-0.039351);
		rlVertex3f(0.631663,0.955669,0.440243);
		rlVertex3f(0.714215,0.614959,0.71421);
		rlVertex3f(0.816878,0.808942,0.43663);
		rlVertex3f(0.419592,0.811837,0.841155);
		rlVertex3f(0.631663,0.955669,0.440243);
		rlVertex3f(0.692168,0.993242,-0.039351);
		rlVertex3f(0.144219,0.987834,0.677821);
		rlVertex3f(-0.761151,0.809834,0.536443);
		rlVertex3f(-0.932322,0.596227,0.399221);
		rlVertex3f(-0.480241,0.605489,0.898445);
		rlVertex3f(0.268884,0.808944,-0.88636);
		rlVertex3f(0.281587,0.989665,-0.627556);
		rlVertex3f(0.740334,0.807581,-0.582152);
		rlVertex3f(-0.745147,0.740689,-0.624636);
		rlVertex3f(-0.298104,0.811837,-0.891479);
		rlVertex3f(-0.473573,0.595546,-0.886123);
		rlVertex3f(0.776975,-0.906855,-0.321834);
		rlVertex3f(0.068047,-1.001798,-0.690904);
		rlVertex3f(0.318952,-0.885314,-0.78363);
		rlVertex3f(0.186015,0.596253,0.996994);
		rlVertex3f(0.419592,0.811837,0.841155);
		rlVertex3f(-0.271929,0.811363,0.896421);
		rlVertex3f(0.692168,0.993242,-0.039351);
		rlVertex3f(0.927452,0.813011,-0.00863);
		rlVertex3f(0.740334,0.807581,-0.582152);
		rlVertex3f(-0.180128,-0.885217,-0.824201);
		rlVertex3f(-0.576616,-0.666864,-0.813833);
		rlVertex3f(-0.22392,-0.648345,-0.979736);
		rlVertex3f(0.776975,-0.906855,-0.321834);
		rlVertex3f(0.577425,-1.0004,0.361353);
		rlVertex3f(0.626238,-1.000449,-0.259399);
		rlVertex3f(0.58222,-0.653549,0.816662);
		rlVertex3f(0.749797,-0.887712,0.407642);
		rlVertex3f(0.853533,-0.658165,0.519577);
		rlVertex3f(-0.180128,-0.885217,-0.824201);
		rlVertex3f(-0.22392,-0.648345,-0.979736);
		rlVertex3f(0.150962,-0.650408,-0.990247);
		rlVertex3f(0.150962,-0.650408,-0.990247);
		rlVertex3f(0.318952,-0.885314,-0.78363);
		rlVertex3f(-0.180128,-0.885217,-0.824201);
		rlVertex3f(0.386682,0.598722,-0.933498);
		rlVertex3f(0.268884,0.808944,-0.88636);
		rlVertex3f(0.740334,0.807581,-0.582152);
		rlVertex3f(0.714215,0.614959,0.71421);
		rlVertex3f(0.419592,0.811837,0.841155);
		rlVertex3f(0.186015,0.596253,0.996994);
		rlVertex3f(-0.271929,0.811363,0.896421);
		rlVertex3f(0.144219,0.987834,0.677821);
		rlVertex3f(-0.300621,0.952344,0.694293);
		rlVertex3f(-0.576616,-0.666864,-0.813833);
		rlVertex3f(-0.661914,-0.895848,-0.523041);
		rlVertex3f(-0.847554,-0.645006,-0.541366);
		rlVertex3f(0.980003,-0.64308,-0.214305);
		rlVertex3f(0.776975,-0.906855,-0.321834);
		rlVertex3f(0.853584,-0.654746,-0.521982);
		rlVertex3f(0.419592,0.811837,0.841155);
		rlVertex3f(0.631663,0.955669,0.440243);
		rlVertex3f(0.144219,0.987834,0.677821);
		rlVertex3f(0.853584,-0.654746,-0.521982);
		rlVertex3f(0.776975,-0.906855,-0.321834);
		rlVertex3f(0.547863,-0.663036,-0.837863);
		rlVertex3f(0.419592,0.811837,0.841155);
		rlVertex3f(0.144219,0.987834,0.677821);
		rlVertex3f(-0.271929,0.811363,0.896421);
		rlVertex3f(-0.058913,0.98919,-0.68411);
		rlVertex3f(0.268884,0.808944,-0.88636);
		rlVertex3f(-0.298104,0.811837,-0.891479);
		rlVertex3f(-0.46681,1.001006,0.438334);
		rlVertex3f(-0.667179,0.954409,0.361812);
		rlVertex3f(-0.300621,0.952344,0.694293);
		rlVertex3f(0.740334,0.807581,-0.582152);
		rlVertex3f(0.553472,0.989602,-0.403198);
		rlVertex3f(0.692168,0.993242,-0.039351);
		rlVertex3f(0.068047,-1.001798,-0.690904);
		rlVertex3f(-0.661914,-0.895848,-0.523041);
		rlVertex3f(-0.180128,-0.885217,-0.824201);
		rlVertex3f(-1.003376,-0.662878,-0.012957);
		rlVertex3f(-0.661914,-0.895848,-0.523041);
		rlVertex3f(-0.834282,-0.895261,0.16595);
		rlVertex3f(0.318952,-0.885314,-0.78363);
		rlVertex3f(0.068047,-1.001798,-0.690904);
		rlVertex3f(-0.180128,-0.885217,-0.824201);
		rlVertex3f(-0.400676,-0.891997,0.74961);
		rlVertex3f(0.130127,-1.000219,0.654195);
		rlVertex3f(0.245288,-0.89031,0.808608);
		rlVertex3f(-0.934972,0.816881,-0.074925);
		rlVertex3f(-0.677363,0.983464,-0.216399);
		rlVertex3f(-0.745147,0.740689,-0.624636);
		rlVertex3f(0.853533,-0.658165,0.519577);
		rlVertex3f(0.749797,-0.887712,0.407642);
		rlVertex3f(0.98674,-0.651095,0.163856);
		rlVertex3f(0.244438,-0.658156,0.970726);
		rlVertex3f(0.245288,-0.89031,0.808608);
		rlVertex3f(0.58222,-0.653549,0.816662);
		rlVertex3f(0.245288,-0.89031,0.808608);
		rlVertex3f(0.130127,-1.000219,0.654195);
		rlVertex3f(0.577425,-1.0004,0.361353);
		rlVertex3f(-0.407554,0.953185,-0.636153);
		rlVertex3f(-0.298104,0.811837,-0.891479);
		rlVertex3f(-0.745147,0.740689,-0.624636);
		rlVertex3f(-0.661914,-0.895848,-0.523041);
		rlVertex3f(-0.671198,-1.000598,0.133513);
		rlVertex3f(-0.834282,-0.895261,0.16595);
		rlVertex3f(0.245288,-0.89031,0.808608);
		rlVertex3f(0.244438,-0.658156,0.970726);
		rlVertex3f(-0.18976,-0.646655,0.988061);
		rlVertex3f(-0.912534,-0.652287,0.421588);
		rlVertex3f(-0.400676,-0.891997,0.74961);
		rlVertex3f(-0.640764,-0.680105,0.763315);
		rlVertex3f(0.816878,0.808942,0.43663);
		rlVertex3f(0.631663,0.955669,0.440243);
		rlVertex3f(0.419592,0.811837,0.841155);
		rlVertex3f(-0.400676,-0.891997,0.74961);
		rlVertex3f(-0.671198,-1.000598,0.133513);
		rlVertex3f(-0.315652,-1.000255,0.590543);
		rlVertex3f(0.996989,0.596266,0.186017);
		rlVertex3f(0.853533,-0.658165,0.519577);
		rlVertex3f(0.98674,-0.651095,0.163856);
		rlVertex3f(-0.098312,0.604673,-0.999773);
		rlVertex3f(-0.298104,0.811837,-0.891479);
		rlVertex3f(0.268884,0.808944,-0.88636);
		rlVertex3f(-0.990832,0.615903,-0.195534);
		rlVertex3f(-0.847554,-0.645006,-0.541366);
		rlVertex3f(-1.003376,-0.662878,-0.012957);
		rlVertex3f(0.386682,0.598722,-0.933498);
		rlVertex3f(0.891344,0.604282,-0.50115);
		rlVertex3f(0.547863,-0.663036,-0.837863);
		rlVertex3f(0.186015,0.596253,0.996994);
		rlVertex3f(0.244438,-0.658156,0.970726);
		rlVertex3f(0.58222,-0.653549,0.816662);
		rlVertex3f(0.996989,0.596266,0.186017);
		rlVertex3f(0.98674,-0.651095,0.163856);
		rlVertex3f(0.980003,-0.64308,-0.214305);
		rlVertex3f(0.891344,0.604282,-0.50115);
		rlVertex3f(0.980003,-0.64308,-0.214305);
		rlVertex3f(0.853584,-0.654746,-0.521982);
		rlVertex3f(0.996989,0.596266,0.186017);
		rlVertex3f(0.714215,0.614959,0.71421);
		rlVertex3f(0.853533,-0.658165,0.519577);
		rlVertex3f(-0.932322,0.596227,0.399221);
		rlVertex3f(-1.003376,-0.662878,-0.012957);
		rlVertex3f(-0.912534,-0.652287,0.421588);
		rlVertex3f(0.714215,0.614959,0.71421);
		rlVertex3f(0.58222,-0.653549,0.816662);
		rlVertex3f(0.853533,-0.658165,0.519577);
		rlVertex3f(0.186015,0.596253,0.996994);
		rlVertex3f(-0.480241,0.605489,0.898445);
		rlVertex3f(-0.18976,-0.646655,0.988061);
		rlVertex3f(0.386682,0.598722,-0.933498);
		rlVertex3f(0.547863,-0.663036,-0.837863);
		rlVertex3f(0.150962,-0.650408,-0.990247);
		rlVertex3f(-0.745147,0.740689,-0.624636);
		rlVertex3f(-0.576616,-0.666864,-0.813833);
		rlVertex3f(-0.847554,-0.645006,-0.541366);
		rlVertex3f(-0.932322,0.596227,0.399221);
		rlVertex3f(-0.990832,0.615903,-0.195534);
		rlVertex3f(-1.003376,-0.662878,-0.012957);
		rlVertex3f(-0.098312,0.604673,-0.999773);
		rlVertex3f(0.386682,0.598722,-0.933498);
		rlVertex3f(0.150962,-0.650408,-0.990247);
		rlVertex3f(-0.990832,0.615903,-0.195534);
		rlVertex3f(-0.745147,0.740689,-0.624636);
		rlVertex3f(-0.847554,-0.645006,-0.541366);
		rlVertex3f(-0.745147,0.740689,-0.624636);
		rlVertex3f(-0.473573,0.595546,-0.886123);
		rlVertex3f(-0.576616,-0.666864,-0.813833);
		rlVertex3f(-0.473573,0.595546,-0.886123);
		rlVertex3f(-0.098312,0.604673,-0.999773);
		rlVertex3f(-0.22392,-0.648345,-0.979736);
		rlVertex3f(-0.400676,-0.891997,0.74961);
		rlVertex3f(-0.315652,-1.000255,0.590543);
		rlVertex3f(0.130127,-1.000219,0.654195);
		rlVertex3f(0.281587,0.989665,-0.627556);
		rlVertex3f(0.553472,0.989602,-0.403198);
		rlVertex3f(0.740334,0.807581,-0.582152);
		rlVertex3f(-0.934972,0.816881,-0.074925);
		rlVertex3f(-0.761151,0.809834,0.536443);
		rlVertex3f(-0.667179,0.954409,0.361812);
		rlVertex3f(-0.677363,0.983464,-0.216399);
		rlVertex3f(-0.058913,0.98919,-0.68411);
		rlVertex3f(-0.407554,0.953185,-0.636153);
		rlVertex3f(0.186015,0.596253,0.996994);
		rlVertex3f(-0.18976,-0.646655,0.988061);
		rlVertex3f(0.244438,-0.658156,0.970726);
		rlVertex3f(-0.18976,-0.646655,0.988061);
		rlVertex3f(-0.640764,-0.680105,0.763315);
		rlVertex3f(-0.400676,-0.891997,0.74961);
		rlVertex3f(0.740334,0.807581,-0.582152);
		rlVertex3f(0.927452,0.813011,-0.00863);
		rlVertex3f(0.891344,0.604282,-0.50115);
		rlVertex3f(0.980003,-0.64308,-0.214305);
		rlVertex3f(0.98674,-0.651095,0.163856);
		rlVertex3f(0.776975,-0.906855,-0.321834);
		rlVertex3f(-0.990832,0.615903,-0.195534);
		rlVertex3f(-0.934972,0.816881,-0.074925);
		rlVertex3f(-0.745147,0.740689,-0.624636);
		rlVertex3f(-0.180128,-0.885217,-0.824201);
		rlVertex3f(-0.661914,-0.895848,-0.523041);
		rlVertex3f(-0.576616,-0.666864,-0.813833);
		rlVertex3f(0.749797,-0.887712,0.407642);
		rlVertex3f(0.245288,-0.89031,0.808608);
		rlVertex3f(0.577425,-1.0004,0.361353);
		rlVertex3f(-0.661914,-0.895848,-0.523041);
		rlVertex3f(-0.517694,-1.00019,-0.424859);
		rlVertex3f(-0.671198,-1.000598,0.133513);
		rlVertex3f(0.776975,-0.906855,-0.321834);
		rlVertex3f(0.749797,-0.887712,0.407642);
		rlVertex3f(0.577425,-1.0004,0.361353);
		rlVertex3f(-0.400676,-0.891997,0.74961);
		rlVertex3f(-0.834282,-0.895261,0.16595);
		rlVertex3f(-0.671198,-1.000598,0.133513);
		rlVertex3f(-1.003376,-0.662878,-0.012957);
		rlVertex3f(-0.847554,-0.645006,-0.541366);
		rlVertex3f(-0.661914,-0.895848,-0.523041);
		rlVertex3f(-0.407554,0.953185,-0.636153);
		rlVertex3f(-0.058913,0.98919,-0.68411);
		rlVertex3f(-0.298104,0.811837,-0.891479);
		rlVertex3f(0.547863,-0.663036,-0.837863);
		rlVertex3f(0.776975,-0.906855,-0.321834);
		rlVertex3f(0.318952,-0.885314,-0.78363);
		rlVertex3f(-0.677363,0.983464,-0.216399);
		rlVertex3f(-0.407554,0.953185,-0.636153);
		rlVertex3f(-0.745147,0.740689,-0.624636);
		rlVertex3f(0.891344,0.604282,-0.50115);
		rlVertex3f(0.386682,0.598722,-0.933498);
		rlVertex3f(0.740334,0.807581,-0.582152);
		rlVertex3f(0.776975,-0.906855,-0.321834);
		rlVertex3f(0.626238,-1.000449,-0.259399);
		rlVertex3f(0.068047,-1.001798,-0.690904);
		rlVertex3f(-0.912534,-0.652287,0.421588);
		rlVertex3f(-0.834282,-0.895261,0.16595);
		rlVertex3f(-0.400676,-0.891997,0.74961);
		rlVertex3f(0.144219,0.987834,0.677821);
		rlVertex3f(-0.46681,1.001006,0.438334);
		rlVertex3f(-0.300621,0.952344,0.694293);
		rlVertex3f(0.553472,0.989602,-0.403198);
		rlVertex3f(0.281587,0.989665,-0.627556);
		rlVertex3f(0.692168,0.993242,-0.039351);
		rlVertex3f(-0.058913,0.98919,-0.68411);
		rlVertex3f(-0.677363,0.983464,-0.216399);
		rlVertex3f(0.281587,0.989665,-0.627556);
		rlVertex3f(-0.46681,1.001006,0.438334);
		rlVertex3f(0.144219,0.987834,0.677821);
		rlVertex3f(0.692168,0.993242,-0.039351);
		rlVertex3f(-0.677363,0.983464,-0.216399);
		rlVertex3f(-0.46681,1.001006,0.438334);
		rlVertex3f(0.281587,0.989665,-0.627556);
		rlVertex3f(-0.473573,0.595546,-0.886123);
		rlVertex3f(-0.22392,-0.648345,-0.979736);
		rlVertex3f(-0.576616,-0.666864,-0.813833);
		rlVertex3f(-0.480241,0.605489,0.898445);
		rlVertex3f(-0.271929,0.811363,0.896421);
		rlVertex3f(-0.761151,0.809834,0.536443);
		rlVertex3f(-0.912534,-0.652287,0.421588);
		rlVertex3f(-1.003376,-0.662878,-0.012957);
		rlVertex3f(-0.834282,-0.895261,0.16595);
		rlVertex3f(0.577425,-1.0004,0.361353);
		rlVertex3f(-0.671198,-1.000598,0.133513);
		rlVertex3f(-0.517694,-1.00019,-0.424859);
		rlVertex3f(-0.932322,0.596227,0.399221);
		rlVertex3f(-0.761151,0.809834,0.536443);
		rlVertex3f(-0.934972,0.816881,-0.074925);
		rlVertex3f(-0.058913,0.98919,-0.68411);
		rlVertex3f(0.281587,0.989665,-0.627556);
		rlVertex3f(0.268884,0.808944,-0.88636);
		rlVertex3f(0.58222,-0.653549,0.816662);
		rlVertex3f(0.245288,-0.89031,0.808608);
		rlVertex3f(0.749797,-0.887712,0.407642);
		rlVertex3f(-0.990832,0.615903,-0.195534);
		rlVertex3f(-0.932322,0.596227,0.399221);
		rlVertex3f(-0.934972,0.816881,-0.074925);
		rlVertex3f(-0.677363,0.983464,-0.216399);
		rlVertex3f(-0.667179,0.954409,0.361812);
		rlVertex3f(-0.46681,1.001006,0.438334);
		rlVertex3f(-0.934972,0.816881,-0.074925);
		rlVertex3f(-0.667179,0.954409,0.361812);
		rlVertex3f(-0.677363,0.983464,-0.216399);
		rlVertex3f(-0.761151,0.809834,0.536443);
		rlVertex3f(-0.271929,0.811363,0.896421);
		rlVertex3f(-0.300621,0.952344,0.694293);
		rlVertex3f(0.068047,-1.001798,-0.690904);
		rlVertex3f(-0.517694,-1.00019,-0.424859);
		rlVertex3f(-0.661914,-0.895848,-0.523041);
		rlVertex3f(0.996989,0.596266,0.186017);
		rlVertex3f(0.927452,0.813011,-0.00863);
		rlVertex3f(0.816878,0.808942,0.43663);
		rlVertex3f(0.130127,-1.000219,0.654195);
		rlVertex3f(-0.315652,-1.000255,0.590543);
		rlVertex3f(0.577425,-1.0004,0.361353);
		rlVertex3f(-0.517694,-1.00019,-0.424859);
		rlVertex3f(0.068047,-1.001798,-0.690904);
		rlVertex3f(0.626238,-1.000449,-0.259399);
		rlVertex3f(-0.315652,-1.000255,0.590543);
		rlVertex3f(-0.671198,-1.000598,0.133513);
		rlVertex3f(0.577425,-1.0004,0.361353);
		rlVertex3f(0.626238,-1.000449,-0.259399);
		rlVertex3f(0.577425,-1.0004,0.361353);
		rlVertex3f(-0.517694,-1.00019,-0.424859);
		rlVertex3f(-0.932322,0.596227,0.399221);
		rlVertex3f(-0.912534,-0.652287,0.421588);
		rlVertex3f(-0.640764,-0.680105,0.763315);
    rlEnd();
}

void draw_specialmesh(SpecialMesh *this, BasePart *part)
{
    switch (this->MeshType)
    {
        case MeshType_Head:
        {
            Vector3 pos = Vector3Add(this->filemesh.datamodelmesh.Offset, ((BasePart*)(this->filemesh.datamodelmesh.instance.Parent))->Position);
            Vector3 scale = this->filemesh.datamodelmesh.Scale;
			Vector3 c = this->filemesh.datamodelmesh.VertexColor;

            rlPushMatrix();
                rlTranslatef(pos.x, pos.y, pos.z);
                rlScalef(scale.x, scale.y, scale.z);
				rlColor4ub(c.x, c.y, c.z, 255);

                draw_head();
            rlPopMatrix();
        } break;
        case MeshType_FileMesh:
        {
            FileMesh_Draw(this, part);
        } break;
        default:
        {
            FIXME("Unsupported MeshType %d.\n", this->MeshType);
        } break;
    }
}

SpecialMesh *SpecialMesh_new(const char *className, Instance *parent)
{
    SpecialMesh *newInst = FileMesh_new("SpecialMesh", parent);

    newInst->filemesh.datamodelmesh.instance.DataCost = sizeof(SpecialMesh);
    newInst = realloc(newInst, sizeof(SpecialMesh));

    newInst->MeshType = MeshType_Head;
    newInst->filemesh.datamodelmesh.drawFunc = draw_specialmesh;

    if (parent) Instance_SetParent(newInst, parent);

    return newInst;
}

void serialize_SpecialMesh(SpecialMesh *specialmesh, SerializeInstance *inst)
{
    serialize_FileMesh(specialmesh, inst);
    
    serialize_atomic(token, specialmesh, MeshType);
}
